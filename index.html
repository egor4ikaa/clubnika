<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üçì –ö–ª—É–±–Ω–∏—á–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</title>
  <link rel="stylesheet" href="style.css">
    
</head>
<body>
  <div class="brand-header">
    <h1>–ö–ª—É–±–Ω–∏—á–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</h1>
    <p>–û–ø—Ä–µ–¥–µ–ª–∏ —Å–æ—Ä—Ç –∫–ª—É–±–Ω–∏–∫–∏ –∑–∞ —Å–µ–∫—É–Ω–¥—É üçì</p>
  </div>

  <div class="container">
    <div id="webcam-container">
      <button id="start-webcam" class="btn">üì∏ –í–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É</button>
      <video id="webcam" autoplay playsinline muted class="hidden"></video>
      <button id="capture" class="btn hidden">–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ</button>
    </div>

    <div id="upload-container">
      <p>–ò–ª–∏ –∑–∞–≥—Ä—É–∑–∏ —Ñ–æ—Ç–æ:</p>
      <label for="image-upload" class="upload-label">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</label>
      <input type="file" id="image-upload" accept="image/*">
    </div>

    <div id="preview" class="hidden">
      <img id="uploaded-image" src="" alt="–ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ —Ñ–æ—Ç–æ">
    </div>

    <div id="prediction">–ó–∞–≥—Ä—É–∑–∏ —Ñ–æ—Ç–æ –∏–ª–∏ –≤–∫–ª—é—á–∏ –∫–∞–º–µ—Ä—É</div>
  </div>

  <!-- TensorFlow.js –∏ Teachable Machine -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.16.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8.6"></script>

<script>
  // ‚úÖ –£–ö–ê–ñ–ò–¢–ï –ü–£–¢–¨ –ö –õ–û–ö–ê–õ–¨–ù–û–ô –ú–û–î–ï–õ–ò
  const MODEL_URL = "./model";

  let model = null;
  let webcam = null;

  async function initModel() {
    try {
      const modelURL = MODEL_URL + "model.json";
      const metadataURL = MODEL_URL + "metadata.json";
      model = await tmImage.load(modelURL, metadataURL);
      document.getElementById('prediction').textContent = "–ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞! –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ üçì";
    } catch (err) {
      console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏:", err);
      document.getElementById('prediction').innerHTML =
        '<strong>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏</strong><br>–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –ø–∞–ø–∫–∞ "model" —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–∞–π–ª—ã model.json, weights.bin, metadata.json';
    }
  }

  async function predict(image) {
    if (!model) return;
    const predictions = await model.predict(image);
    showResult(predictions);
  }

  function showResult(predictions) {
    let best = { className: "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ", probability: 0 };
    for (let i = 0; i < predictions.length; i++) {
      if (predictions[i].probability > best.probability) {
        best = predictions[i];
      }
    }

    const percent = Math.round(best.probability * 100);
    const resultText = percent > 60
      ? `–°–æ—Ä—Ç: <strong>${best.className}</strong> (${percent}%)`
      : `–ù–µ —É–≤–µ—Ä–µ–Ω... –í–æ–∑–º–æ–∂–Ω–æ, <strong>${best.className}</strong> (${percent}%)`;

    document.getElementById('prediction').innerHTML = resultText;
  }

  document.getElementById('image-upload').addEventListener('change', async (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const img = document.getElementById('uploaded-image');
    img.src = URL.createObjectURL(file);
    document.getElementById('preview').classList.remove('hidden');

    img.onload = () => predict(img);
  });

  document.getElementById('start-webcam').addEventListener('click', async () => {
    const video = document.getElementById('webcam');
    const captureBtn = document.getElementById('capture');

    try {
      webcam = new tmImage.Webcam(320, 240, true);
      await webcam.setup();
      await webcam.play();
      video.srcObject = webcam.stream;
      video.classList.remove('hidden');
      captureBtn.classList.remove('hidden');
    } catch (err) {
      console.error("–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ:", err);
      document.getElementById('prediction').innerHTML =
        '<strong>‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ</strong><br>–†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞';
    }
  });

  document.getElementById('capture').addEventListener('click', async () => {
    if (!webcam?.canvas) return;
    predict(webcam.canvas);
  });

  window.addEventListener('load', initModel);
</script>
</body>

</html>
